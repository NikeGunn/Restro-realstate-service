# Kustomization for applying all manifests
# Usage: kubectl apply -k k8s/
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: chatplatform

# Resources to deploy (order matters for dependencies)
resources:
  # Base configuration
  - namespace.yaml
  - configmap.yaml
  - secrets.yaml

  # Data stores (StatefulSets)
  - postgres/statefulset.yaml
  - postgres/service.yaml
  - redis/statefulset.yaml
  - redis/service.yaml

  # Application deployments
  - backend/pvc.yaml
  - backend/deployment.yaml
  - backend/service.yaml
  - backend/hpa.yaml

  - frontend/deployment.yaml
  - frontend/service.yaml
  - frontend/hpa.yaml

  - celery-worker/deployment.yaml
  - celery-beat/deployment.yaml

  # Networking
  - ingress.yaml

  # TLS
  - cert-manager/cluster-issuer.yaml

# Common labels applied to all resources
commonLabels:
  app.kubernetes.io/part-of: chatplatform
  app.kubernetes.io/managed-by: kustomize

# Images (can be overridden per environment)
images:
  - name: nikegunn/chatplatform-backend
    newTag: latest
  - name: nikegunn/chatplatform-frontend
    newTag: latest
